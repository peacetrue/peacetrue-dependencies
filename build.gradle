plugins {
    id "java-platform"
    id "maven-publish"
}

group "com.github.peacetrue"
version "${peaceDependenciesVersion}${tailSnapshot}"

javaPlatform {
    allowDependencies()
}

dependencies {
//    api platform("org.springframework.boot:spring-boot-dependencies:${springBootVersion}")

    constraints {
        api "com.github.peacetrue:peacetrue-beans:${peaceVersion}${tailSnapshot}"
        api "com.github.peacetrue:peacetrue-validation:${peaceVersion}${tailSnapshot}"
        api "com.github.peacetrue:peacetrue-test:${peaceVersion}${tailSnapshot}"

        api "com.github.peacetrue.spring:peacetrue-spring-beans:${peaceSpringVersion}${tailSnapshot}"

        api "com.github.peacetrue.result:peacetrue-result-core:${peaceResultVersion}${tailSnapshot}"
        api "com.github.peacetrue.result:peacetrue-result-builder:${peaceResultVersion}${tailSnapshot}"
        api "com.github.peacetrue.result:peacetrue-result-success:${peaceResultVersion}${tailSnapshot}"
        api "com.github.peacetrue.result:peacetrue-result-exception:${peaceResultVersion}${tailSnapshot}"
        api "com.github.peacetrue.result:peacetrue-result-exception-support:${peaceResultVersion}${tailSnapshot}"

        api "com.google.code.findbugs:jsr305:3.0.2"
        api "org.unitils:unitils-core:3.4.2"
        api "io.github.benas:random-beans:3.7.0"
        api "org.jeasy:easy-random-core:4.2.0"
        api "com.google.guava:guava:30.1.1-jre"
        api "mysql:mysql-connector-java:5.1.46"
        api "org.aspectj:aspectjweaver:1.9.0"
        api "org.aspectj:aspectjrt:1.9.0"
        api "org.reflections:reflections:0.9.11"
        api "org.jooq:jool:0.9.13"
        api "org.jooq:jool-java-8:0.9.13"
        api "org.jooq:jooq:3.13.1"
        api "org.projectlombok:lombok:1.18.6"
        api "org.junit.jupiter:junit-jupiter-api:5.7.0"
        api "org.junit.jupiter:junit-jupiter-engine:5.7.0"
        api "com.alibaba:fastjson:1.2.79" //@JSON
    }
}

publishing {
    publications {
        mavenJava(MavenPublication) {
            from components.javaPlatform
            pom {
                name = project.name
                description = project.description

                url = "https://peacetrue.cn/summarize/${project.name}/index.html"
                licenses {
                    license {
                        name = "The Apache License, Version 2.0"
                        url = "https://www.apache.org/licenses/LICENSE-2.0.txt"
                    }
                }

                developers {
                    developer {
                        id = "peace"
                        name = "peace"
                        email = "xiayouxue@hotmail.com"
                    }
                }

                scm {
                    connection = "scm:git:git://github.com/peacetrue/${project.name}.git"
                    developerConnection = "scm:git:ssh://github.com/peacetrue/${project.name}.git"
                    //FailureMessage	Invalid POM: /com/github/peacetrue/gradle/1.0.0/gradle-1.0.0.pom: SCM URL missing
                    url = "https://github.com/peacetrue/${project.name}.git"
                }
            }
        }
    }

    repositories {
        maven {
            def snapshotsRepoUrl = "https://oss.sonatype.org/content/repositories/snapshots/"
            def releasesRepoUrl = "https://oss.sonatype.org/service/local/staging/deploy/maven2/"
            url = version.endsWith("SNAPSHOT") ? snapshotsRepoUrl : releasesRepoUrl
            credentials {
                username = "${ossrhUsername}"
                password = "${ossrhPassword}"
            }
        }
    }
}

apply plugin: "signing"

signing {
    sign publishing.publications.mavenJava
}
